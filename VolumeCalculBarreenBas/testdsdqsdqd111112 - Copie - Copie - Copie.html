<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Calculateur de Volume - Version Corrig√©e</title>
<style>
  :root{--accent:#ff7f00;--bg:#f7f7f7;--card:#fff;--dark:#111;}
  body{font-family:Arial,Helvetica,sans-serif;margin:0;background:var(--bg);color:#222;}
  header{position:fixed;top:0;left:0;right:0;background:var(--dark);color:#fff;z-index:1000;display:flex;flex-direction:column;align-items:center;padding:10px 0;box-shadow:0 2px 6px rgba(0,0,0,0.15);}
  .search-wrap{width:100%;display:flex;justify-content:center;padding:6px 16px;}
  #search{width:54%;max-width:900px;border-radius:24px;padding:8px 14px;border:none;font-size:15px;}
  .cats{margin-top:8px;width:100%;background:#111;display:flex;justify-content:center;flex-wrap:wrap;gap:10px;padding:8px 12px;}
  .cats button{border:0;background:#222;color:#ccc;padding:6px 12px;border-radius:18px;cursor:pointer;font-size:14px;}
  .cats button.active,.cats button:hover{background:var(--accent);color:#fff;}
  .page{display:flex;gap:20px;align-items:flex-start;padding:20px;padding-top:150px;}
  .grid{flex:1 1 auto;display:grid;grid-template-columns: repeat(4,minmax(200px,1fr));gap:14px;}
  .card{background:var(--card);border-radius:10px;padding:10px;box-shadow:0 2px 6px rgba(0,0,0,0.06);display:flex;flex-direction:column;align-items:stretch;min-height:110px;font-size:13px;position: relative;}
  .card-top{display:flex;align-items:center;gap:10px;
  .card.selected::after {
  content: '';
  position: absolute;
  top: 6px;
  right: 6px;
  width: 12px;
  height: 12px;
  background-color: var(--accent); /* orange */
  border-radius: 50%;
  box-shadow: 0 0 3px rgba(0,0,0,0.3);
}}
  .thumb{width:44px;height:44px;background:#f0f0f0;border-radius:6px;object-fit:cover;flex-shrink:0;}
  .title{font-weight:600;line-height:1.15;}
  .controls{display:flex;align-items:center;justify-content:center;gap:8px;margin-top:8px;}
  .controls button{width:28px;height:28px;border-radius:50%;border:0;background:var(--accent);color:#fff;font-weight:700;cursor:pointer;font-size:15px;}
  .qty{width:34px;text-align:center;font-weight:700;}
  .opts{display:flex;justify-content:center;gap:8px;margin-top:8px;font-size:12px;flex-wrap:wrap;}
  .opts label{display:flex;align-items:center;gap:6px;cursor:pointer;}
  aside h3{margin:0 0 10px 0;color:var(--accent);text-align:center;}
  .mat-row{display:flex;justify-content:space-between;padding:8px 6px;border-radius:8px;margin-bottom:8px;background:#fbfbfb;}
  .total-row{display:flex;justify-content:space-between;font-weight:700;padding-top:6px;border-top:1px dashed #eee;margin-top:10px;}
  .truck{color:var(--accent);font-style:italic;text-align:right;margin-top:10px;font-size:0.95rem;}
  @media (max-width:1100px){.grid{grid-template-columns:repeat(3,minmax(180px,1fr));}aside{display:none;}}
  @media (max-width:800px){.grid{grid-template-columns:repeat(2,minmax(160px,1fr));}#search{width:80%;}}
  @media (max-width:480px){.grid{grid-template-columns:repeat(1,minmax(120px,1fr));}#search{width:90%;}}
  
/* === Barre r√©capitulative sombre lisible === */
aside {
  position: fixed !important;
  bottom: 0 !important;
  left: 0 !important;
  right: 0 !important;
  background: rgba(20, 20, 20, 0.95);
  backdrop-filter: blur(6px);
  -webkit-backdrop-filter: blur(6px);
  color: #f4f4f4;
  border-top: 2px solid var(--accent);
  box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.5);
  padding: 14px 24px;
  z-index: 1001 !important;
  display: flex;
  justify-content: center;
  align-items: center;
  width: 100%;
}

/* Contenu principal du r√©cap */
#sidebarInner {
  display: flex;
  align-items: flex-start;
  justify-content: space-between;
  flex-wrap: wrap;
  gap: 40px;
  max-width: 1100px;
  width: 100%;
}

/* Titre */
#sidebarInner h3 {
  margin: 0 0 8px;
  font-size: 1rem;
  color: var(--accent);
  font-weight: 700;
}

/* Liste des mat√©riaux */
#materialsList {
  display: flex;
  flex-direction: column;
  gap: 3px;              /* espace r√©duit entre les lignes */
  background: rgba(255, 255, 255, 0.05); /* fond l√©ger et discret */
  padding: 6px 10px;     /* r√©duit la marge interne */
  border-radius: 6px;
  border: 1px solid rgba(255, 255, 255, 0.1);
  min-width: 180px;      /* largeur un peu plus compacte */
  font-size: 0.85rem;    /* texte l√©g√®rement plus petit */
}

#materialsList div {
  display: flex;
  justify-content: space-between;
  background: rgba(255, 255, 255, 0.08);
  padding: 3px 6px;
  border-radius: 4px;
  font-size: 0.9rem;
  color: #f1f1f1;
  min-width: 200px;
  transition: background 0.2s ease;
}

#materialsList div:hover {
  background: rgba(255, 255, 255, 0.15);
}

/* Totaux align√©s √† droite */
.recap-totaux {
  display: flex;
  flex-direction: column;
  gap: 4px;
  text-align: right;
  font-size: 0.95rem;
  color: #fff;
}

.recap-totaux strong {
  color: var(--accent);
}

/* Camion */
.truck {
  color: var(--accent);
  font-weight: 600;
  font-size: 1rem;
  margin-top: 6px;
}

/* Bouton PDF rond */
#telechargerPDF {
  background: var(--accent);
  color: #fff;
  border: none;
  border-radius: 50%;
  width: 38px;
  height: 38px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 18px;
  cursor: pointer;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.4);
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}

#telechargerPDF:hover {
  transform: scale(1.1);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.6);
}

/* Espace pour la barre */
.page {
  padding-bottom: 140px;
}

/* Responsive */
@media (max-width: 700px) {
  #sidebarInner {
    flex-direction: column;
    align-items: center;
    text-align: center;
    gap: 10px;
  }

  #materialsList div {
    min-width: 160px;
  }

  .recap-totaux {
    align-items: center;
  }
}

/* === Effet d'apparition en fondu du r√©capitulatif === */
aside {
  opacity: 0;
  transform: translateY(100%);
  transition: opacity 0.6s ease, transform 0.6s ease;
}

aside.visible {
  opacity: 1;
  transform: translateY(0);
}



  
</style>
</head>
<body>

<header>
  <div class="search-wrap">
    <input id="search" placeholder="Rechercher un objet (ex: armoire, carton)..." />
  </div>

  <div class="cats" id="cats">
    <button class="active" data-cat="Tous">Tous</button>
    <button data-cat="Salon">Salon</button>
    <button data-cat="S√©jour">S√©jour</button>
    <button data-cat="Cuisine">Cuisine</button>
    <button data-cat="Chambres">Chambres</button>
    <button data-cat="Garage">Garage</button>
    <button data-cat="Jardin">Jardin</button>
    <button data-cat="Sanitaire">Sanitaire</button>
  </div>
</header>

<!-- === CONTENU PRINCIPAL === -->
<div class="page">
  <div class="grid" id="grid"></div>
</div>

<!-- === R√âCAPITULATIF FIXE EN BAS (version pr√©c√©dente) === -->
<aside>
  <div id="sidebarInner">
    <div>
      <h3>R√©capitulatif</h3>
      <div id="materialsList"></div>
    </div>

    <div class="recap-totaux">
      <div><strong>Total g√©n√©ral :</strong> <span id="totalGeneral">0.00 m¬≥</span></div>
      <div><strong>R√©cup :</strong> <span id="totalKeep">0.00 m¬≥</span></div>
      <div><strong></strong> <span id="truckEstimate">0.00</span></div>
    </div>

    <button id="telechargerPDF" title="T√©l√©charger le r√©capitulatif en PDF">üìÑ</button>
  </div>
</aside>






</div>

<script>
/* --- Donn√©es (m√™mes que pr√©c√©demment) --- */
const ITEMS = [
  /* === SALON === */
  {name:"Armoire 1 porte", category:"Salon", material:"Bois", volume:1, dismantle:true, canBeFull: true, image:""},
  {name:"Armoire 2 portes", category:"Salon", material:"Bois", volume:2, dismantle:true, canBeFull: true, image:""},
  {name:"Aspirateur", category:"Salon", material:"√âlectrom√©nager", volume:0.4, dismantle:false, canBeFull: false, image:""},
  {name:"Tv", category:"Salon", material:"Electrom√©nager", volume:0.3, dismantle:false, image:""},
  {name:"Bahut", category:"Salon", material:"Bois", volume:2.5, dismantle:true, canBeFull: true, image:""},
  {name:"Chaise", category:"Salon", material:"Mobilier", volume:0.15, dismantle:true, image:""},
  {name:"Canap√© 2 places", category:"Salon", material:"Mobilier", volume:2, dismantle:true, image:""},
  {name:"Canap√© 3 places", category:"Salon", material:"Mobilier", volume:2.5, dismantle:true, image:""},
  {name:"Canap√© d'angle", category:"Salon", material:"Mobilier", volume:3, dismantle:true, image:""},
  {name:"Carton penderie", category:"Salon", material:"Carton", volume:1.8, dismantle:false, canBeFull: true, image:""},
  {name:"Carton standard", category:"Salon", material:"Carton", volume:0.1, dismantle:false, canBeFull: true, image:""},
  {name:"Commode", category:"Salon", material:"Bois", volume:1.5, dismantle:true, canBeFull: true, image:""},
  {name:"Commode 6 tiroirs ", category:"Salon", material:"Bois", volume:1.2, dismantle:true, canBeFull: true, image:""},
  {name:"Divers / M3 supplementaire", category:"Salon", material:"Tout venant", volume:1, dismantle:false, image:""},
  {name:"Etag√®re", category:"Salon", material:"Bois", volume:0.25, dismantle:true, canBeFull: true, image:""},
  {name:"Fauteuil", category:"Salon", material:"Mobilier", volume:1, dismantle:false, image:""},
  {name:"Halog√®ne", category:"Salon", material:"Tout venant", volume:0.75, dismantle:false, image:""},
  {name:"Lustre", category:"Salon", material:"Tout venant", volume:0.25, dismantle:false, image:""},
  {name:"Meuble living", category:"Salon", material:"Bois", volume:3, dismantle:true, canBeFull: true, image:""},
  {name:"Petite Lampe", category:"Salon", material:"Tout venant", volume:0.2, dismantle:false, image:""},
  {name:"Piano demi queue", category:"Salon", material:"Mobilier", volume:3.5, dismantle:false, image:""},
  {name:"Piano droit", category:"Salon", material:"Mobilier", volume:2, dismantle:false, image:""},
  {name:"Piano queue", category:"Salon", material:"Mobilier", volume:4.5, dismantle:false, image:""},
  {name:"Plante", category:"Salon", material:"Tout venant", volume:0.5, dismantle:false, image:""},
  {name:"Table de chevet", category:"Salon", material:"Bois", volume:0.2, dismantle:true, image:""},
  {name:"Table ronde", category:"Salon", material:"Bois", volume:0.5, dismantle:true, image:""},
  {name:"Tableau", category:"Salon", material:"Tout venant", volume:0.1, dismantle:false, image:""},
  {name:"Vaisselier", category:"Salon", material:"Bois", volume:2, dismantle:true, canBeFull: true, image:""},

  /* === S√âJOUR === */
  {name:"Armoire 1 porte", category:"S√©jour", material:"Bois", volume:1, dismantle:true, canBeFull: true, image:""},
  {name:"Armoire 2 portes", category:"S√©jour", material:"Bois", volume:2, dismantle:true, canBeFull: true, image:""},
  {name:"Aspirateur", category:"S√©jour", material:"√âlectrom√©nager", volume:0.5, dismantle:false, image:""},
  {name:"Bahut", category:"S√©jour", material:"Bois", volume:2.5, dismantle:true, canBeFull: true, image:""},
  {name:"Canap√© 2 places", category:"S√©jour", material:"Mobilier", volume:2, dismantle:true, image:""},
  {name:"Canap√© 3 places ", category:"S√©jour", material:"Mobilier", volume:2.5, dismantle:true, image:""},
  {name:"Canap√© d'angle", category:"S√©jour", material:"Mobilier", volume:3, dismantle:true, image:""},
  {name:"Carton penderie", category:"S√©jour", material:"Carton", volume:1.8, dismantle:false, canBeFull: true, image:""},
  {name:"Carton standard", category:"S√©jour", material:"Carton", volume:0.1, dismantle:false, canBeFull: true, image:""},
  {name:"Commode", category:"S√©jour", material:"Bois", volume:1.5, dismantle:true, canBeFull: true, image:""},
  {name:"Commode 6 tiroirs", category:"S√©jour", material:"Bois", volume:1.2, dismantle:true, canBeFull: true, image:""},
  {name:"Divers / M3 supplementaire", category:"S√©jour", material:"Tout venant", volume:1, dismantle:false, image:""},
  {name:"Etag√®re", category:"S√©jour", material:"Bois", volume:0.25, dismantle:true, canBeFull: true, image:""},
  {name:"Halog√®ne", category:"S√©jour", material:"Tout venant", volume:0.75, dismantle:false, image:""},
  {name:"Lave vaisselle", category:"S√©jour", material:"√âlectrom√©nager", volume:0.5, dismantle:false, image:""},
  {name:"Lustre", category:"S√©jour", material:"Tout venant", volume:0.25, dismantle:false, image:""},
  {name:"Meuble living", category:"S√©jour", material:"Bois", volume:3, dismantle:true, canBeFull: true, image:""},
  {name:"Micro-onde", category:"S√©jour", material:"√âlectrom√©nager", volume:0.25, dismantle:false, image:""},
  {name:"Petite Lampe", category:"S√©jour", material:"Tout venant", volume:0.25, dismantle:false, image:""},
  {name:"Piano demi queue", category:"S√©jour", material:"Mobilier", volume:3.5, dismantle:false, image:""},
  {name:"Piano droit", category:"S√©jour", material:"Mobilier", volume:2, dismantle:false, image:""},
  {name:"Piano queue", category:"S√©jour", material:"Mobilier", volume:4.5, dismantle:false, image:""},
  {name:"Plante", category:"S√©jour", material:"Tout venant", volume:0.5, dismantle:false, image:""},
  {name:"Table de chevet", category:"S√©jour", material:"Bois", volume:0.2, dismantle:true, image:""},
  {name:"Table ronde", category:"S√©jour", material:"Bois", volume:0.5, dismantle:true, image:""},
  {name:"Tableau", category:"S√©jour", material:"Tout venant", volume:0.1, dismantle:false, image:""},
  {name:"Vaisselier", category:"S√©jour", material:"Bois", volume:2, dismantle:true, canBeFull: true, image:""},

  /* === CUISINE === */
  {name:"Armoire 1 porte", category:"Cuisine", material:"Bois", volume:1, dismantle:true, canBeFull: true, image:""},
  {name:"Armoire 2 portes", category:"Cuisine", material:"Bois", volume:2, dismantle:true, canBeFull: true, image:""},
  {name:"Aspirateur", category:"Cuisine", material:"√âlectrom√©nager", volume:0.5, dismantle:false, image:""},
  {name:"Bahut", category:"Cuisine", material:"Bois", volume:2.5, dismantle:true, canBeFull: true, image:""},
  {name:"Cafetiere", category:"Cuisine", material:"Tout venant", volume:0.1, dismantle:false, image:""},
  {name:"Carton standard", category:"Cuisine", material:"Carton", volume:0.1, dismantle:false, canBeFull: true, image:""},
  {name:"Casseroles", category:"Cuisine", material:"Tout venant", volume:0.1, dismantle:false, image:""},
  {name:"Commode 6 tiroirs", category:"Cuisine", material:"Bois", volume:1.2, dismantle:true, canBeFull: true, image:""},
  {name:"Congelateur coffre", category:"Cuisine", material:"√âlectrom√©nager", volume:1.5, dismantle:false, canBeFull: true, image:""},
  {name:"Divers / M3 supplementaire", category:"Cuisine", material:"Tout venant", volume:1, dismantle:false, canBeFull: true, image:""},
  {name:"Etag√®re", category:"Cuisine", material:"Bois", volume:0.25, dismantle:true, canBeFull: true, image:""},
  {name:"Petit Frigo", category:"Cuisine", material:"√âlectrom√©nager", volume:0.5, dismantle:false, canBeFull: true, image:""},
  {name:"Frigo normal", category:"Cuisine", material:"√âlectrom√©nager", volume:1, dismantle:false, canBeFull: true, image:""},
  {name:"Frigo am√©ricain", category:"Cuisine", material:"√âlectrom√©nager", volume:2, dismantle:false, canBeFull: true, image:""},
  {name:"Gazini√®re", category:"Cuisine", material:"√âlectrom√©nager", volume:0.5, dismantle:false, image:""},
  {name:"Lave Linge", category:"Cuisine", material:"√âlectrom√©nager", volume:0.5, dismantle:false, image:""},
  {name:"Lave vaisselle", category:"Cuisine", material:"√âlectrom√©nager", volume:0.5, dismantle:false, image:""},
  {name:"Lustre", category:"Cuisine", material:"Tout venant", volume:0.25, dismantle:false, image:""},
  {name:"Meuble bas cuisine", category:"Cuisine", material:"Bois", volume:1, dismantle:true, canBeFull: true, image:""},
  {name:"Meuble haut cuisine", category:"Cuisine", material:"Bois", volume:0.5, dismantle:true, canBeFull: true, image:""},
  {name:"Meuble living", category:"Cuisine", material:"Bois", volume:3, dismantle:true, canBeFull: true, image:""},
  {name:"Meuble sous lavabo", category:"Cuisine", material:"Bois", volume:0.8, dismantle:true, canBeFull: true, image:""},
  {name:"Micro-onde", category:"Cuisine", material:"√âlectrom√©nager", volume:0.25, dismantle:false, image:""},
  {name:"Petit congelateur", category:"Cuisine", material:"√âlectrom√©nager", volume:1, dismantle:false, canBeFull: true, image:""},
  {name:"Petite Lampe", category:"Cuisine", material:"Tout venant", volume:0.2, dismantle:false, image:""},
  {name:"Piano queue", category:"Cuisine", material:"Mobilier", volume:4.5, dismantle:false, image:""},
  {name:"Plan de travail", category:"Cuisine", material:"Bois", volume:1, dismantle:true, image:""},
  {name:"Plante", category:"Cuisine", material:"Tout venant", volume:0.5, dismantle:false, image:""},
  {name:"Plaque de cuisson", category:"Cuisine", material:"√âlectrom√©nager", volume:0.3, dismantle:false, image:""},
  {name:"Seche Linge", category:"Cuisine", material:"√âlectrom√©nager", volume:0.5, dismantle:false, image:""},
  {name:"Table ronde", category:"Cuisine", material:"Bois", volume:0.5, dismantle:true, image:""},
  {name:"Tableau", category:"Cuisine", material:"Tout venant", volume:0.1, dismantle:false, image:""},
  {name:"Vaisselier", category:"Cuisine", material:"Bois", volume:2, dismantle:true, image:""},
  /* === CHAMBRES === */
  {name:"Armoire 1 porte", category:"Chambres", material:"Bois", volume:1, dismantle:true, canBeFull: true, image:""},
  {name:"Armoire 2 portes", category:"Chambres", material:"Bois", volume:2, dismantle:true, canBeFull: true, image:""},
  {name:"Bahut", category:"Chambres", material:"Bois", volume:2.5, dismantle:true, canBeFull: true, image:""},
  {name:"Canap√© 2 places", category:"Chambres", material:"Mobilier", volume:2, dismantle:true, image:""},
  {name:"Canap√© 3 places", category:"Chambres", material:"Mobilier", volume:2.5, dismantle:true, image:""},
  {name:"Carton penderie", category:"Chambres", material:"Carton", volume:1.8, dismantle:false, canBeFull: true, image:""},
  {name:"Carton standard", category:"Chambres", material:"Carton", volume:0.1, dismantle:false, canBeFull: true, image:""},
  {name:"Coiffeuse", category:"Chambres", material:"Bois", volume:1.5, dismantle:true, image:""},
  {name:"Commode", category:"Chambres", material:"Bois", volume:1.5, dismantle:true, canBeFull: true, image:""},
  {name:"Commode 6 tiroirs", category:"Chambres", material:"Bois", volume:1.2, dismantle:true, canBeFull: true, image:""},
  {name:"Divers / M3 supplementaire", category:"Chambres", material:"Tout venant", volume:1, dismantle:false, canBeFull: true, image:""},
  {name:"Etag√®re", category:"Chambres", material:"Bois", volume:0.25, dismantle:true, canBeFull: true, image:""},
  {name:"Fauteuil", category:"Chambres", material:"Mobilier", volume:1, dismantle:false, image:""},
  {name:"Halog√®ne", category:"Chambres", material:"Tout venant", volume:0.75, dismantle:false, image:""},
  {name:"Lit 2 places", category:"Chambres", material:"MixteLit", volume:2, dismantle:true, image:""},
  {name:"Lit simple 90", category:"Chambres", material:"Bois", volume:1.5, dismantle:true, image:""},
  {name:"Lit superpos√©", category:"Chambres", material:"Bois", volume:2.5, dismantle:true, image:""},
  {name:"Lustre", category:"Chambres", material:"Tout venant", volume:0.25, dismantle:false, image:""},
  {name:"Meuble living", category:"Chambres", material:"Bois", volume:3, dismantle:true, canBeFull: true, image:""},
  {name:"Petite Lampe", category:"Chambres", material:"Tout venant", volume:0.25, dismantle:false, image:""},
  {name:"Piano demi queue", category:"Chambres", material:"Mobilier", volume:3.5, dismantle:false, image:""},
  {name:"Piano droit", category:"Chambres", material:"Mobilier", volume:2, dismantle:false, image:""},
  {name:"Piano queue", category:"Chambres", material:"Mobilier", volume:4.5, dismantle:false, image:""},
  {name:"Plante", category:"Chambres", material:"Tout venant", volume:0.5, dismantle:false, image:""},
  {name:"Table de chevet", category:"Chambres", material:"Bois", volume:0.2, dismantle:true, image:""},
  {name:"Table ronde", category:"Chambres", material:"Bois", volume:0.5, dismantle:true, image:""},
  {name:"Tableau", category:"Chambres", material:"Tout venant", volume:0.1, dismantle:false, image:""},
  /* === GARAGE === */
  {name:"Armoire 1 porte", category:"Garage", material:"Bois", volume:1.5, dismantle:true, canBeFull: true, image:""},
  {name:"Armoire 2 portes", category:"Garage", material:"Bois", volume:2.5, dismantle:true, canBeFull: true, image:""},
  {name:"Aspirateur", category:"Garage", material:"√âlectrom√©nager", volume:0.5, dismantle:false, image:""},
  {name:"Cafetiere", category:"Garage", material:"Tout venant", volume:0.1, dismantle:false, image:""},
  {name:"Carton standard", category:"Garage", material:"Carton", volume:0.1, dismantle:false, canBeFull: true, image:""},
  {name:"Casseroles", category:"Garage", material:"Tout venant", volume:0.1, dismantle:false, image:""},
  {name:"Commode", category:"Garage", material:"Bois", volume:1.5, dismantle:true, canBeFull: true, image:""},
  {name:"Commode 6 tiroirs", category:"Garage", material:"Bois", volume:1.2, dismantle:true, canBeFull: true, image:""},
  {name:"Congelateur coffre", category:"Garage", material:"√âlectrom√©nager", volume:1.5, dismantle:false, canBeFull: true, image:""},
  {name:"Etabli", category:"Garage", material:"Bois", volume:1.5, dismantle:true, canBeFull: true, image:""},
  {name:"Etag√®re", category:"Garage", material:"Bois", volume:0.75, dismantle:true, canBeFull: true, image:""},
  {name:"Petit Frigo", category:"Garage", material:"√âlectrom√©nager", volume:0.5, dismantle:false, canBeFull: true, image:""},
  {name:"Frigo normal", category:"Garage", material:"√âlectrom√©nager", volume:1, dismantle:false, canBeFull: true, image:""},
  {name:"Gazini√®re", category:"Garage", material:"√âlectrom√©nager", volume:0.5, dismantle:false, image:""},
  {name:"Lave Linge", category:"Garage", material:"√âlectrom√©nager", volume:0.5, dismantle:false, image:""},
  {name:"Lot-outils", category:"Garage", material:"Ferraille", volume:0.7, dismantle:false, image:""},
  {name:"Ferraille", category:"Garage", material:"Ferraille", volume:1, dismantle:false, image:""},
  {name:"Meuble bas cuisine", category:"Garage", material:"Bois", volume:1, dismantle:true, canBeFull: true, image:""},
  {name:"Meuble haut cuisine", category:"Garage", material:"Bois", volume:0.5, dismantle:true, canBeFull: true, image:""},
  {name:"Meuble living", category:"Garage", material:"Bois", volume:3, dismantle:true, image:""},
  {name:"Meuble sous lavabo", category:"Garage", material:"Bois", volume:0.8, dismantle:true, canBeFull: true, image:""},
  {name:"Parasol", category:"Garage", material:"Tout venant", volume:0.3, dismantle:false, image:""},
  {name:"Petit congelateur", category:"Garage", material:"√âlectrom√©nager", volume:1, dismantle:false, canBeFull: true, image:""},
  {name:"Petite Lampe", category:"Garage", material:"Tout venant", volume:0.2, dismantle:false, image:""},
  {name:"Pousette", category:"Garage", material:"Mobilier", volume:0.8, dismantle:false, image:""},
  {name:"Scooter", category:"Garage", material:"Ferraille", volume:2, dismantle:false, image:""},
  {name:"Seche Linge", category:"Garage", material:"√âlectrom√©nager", volume:0.5, dismantle:false, image:""},
  {name:"Tondeuse", category:"Garage", material:"Ferraille", volume:0.3, dismantle:false, image:""},
  {name:"Transat", category:"Garage", material:"Tout venant", volume:0.5, dismantle:false, image:""},
  {name:"Vaisselier", category:"Garage", material:"Bois", volume:2, dismantle:true, canBeFull: true, image:""},
  {name:"V√©lo", category:"Garage", material:"Ferraille", volume:0.8, dismantle:false, image:""},
  /* === JARDIN === */
  {name:"Carton standard", category:"Jardin", material:"Carton", volume:0.1, dismantle:false, canBeFull: true, image:""},
  {name:"Divers / M3 supplementaire", category:"Jardin", material:"Tout venant", volume:1, dismantle:false, image:""},
  {name:"Parasol", category:"Jardin", material:"Tout venant", volume:0.3, dismantle:false, image:""},
  {name:"Plante", category:"Jardin", material:"Tout venant", volume:0.5, dismantle:false, image:""},
  {name:"Tondeuse", category:"Jardin", material:"Ferraille", volume:0.3, dismantle:false, image:""},
  {name:"Transat", category:"Jardin", material:"Tout venant", volume:0.5, dismantle:false, image:""},
  {name:"V√©lo", category:"Jardin", material:"Ferraille", volume:0.8, dismantle:false, image:""},
  /* === SANITAIRE === */
  {name:"Armoire 1 porte", category:"Sanitaire", material:"Bois", volume:1, dismantle:true, canBeFull: true, image:""},
  {name:"Carton standard", category:"Sanitaire", material:"Carton", volume:0.1, dismantle:false, canBeFull: true, image:""},
  {name:"Coiffeuse", category:"Sanitaire", material:"Bois", volume:1.5, dismantle:true, image:""},
  {name:"Divers / M3 supplementaire", category:"Sanitaire", material:"Tout venant", volume:1, dismantle:false, image:""},
  {name:"Etag√®re", category:"Sanitaire", material:"Bois", volume:0.25, dismantle:true, canBeFull: true, image:""},
  {name:"Lave Linge", category:"Sanitaire", material:"√âlectrom√©nager", volume:0.5, dismantle:false, image:""},
  {name:"Lustre", category:"Sanitaire", material:"Tout venant", volume:0.25, dismantle:false, image:""},
  {name:"Meuble sous lavabo", category:"Sanitaire", material:"Bois", volume:0.8, dismantle:true, canBeFull: true, image:""},
  {name:"Petite Lampe", category:"Sanitaire", material:"Tout venant", volume:0.2, dismantle:false, image:""},
  {name:"Pharmacie", category:"Sanitaire", material:"Tout venant", volume:0.4, dismantle:false, image:""},
  {name:"Seche Linge", category:"Sanitaire", material:"√âlectrom√©nager", volume:0.5, dismantle:false, image:""},
  {name:"Tableau", category:"Sanitaire", material:"Tout venant", volume:0.1, dismantle:false, image:""}
];

/* STATE stores per-index selections */
const STATE = {}; // STATE[idx] = { qty, dismantle, full, keep }

/* DOM refs */
const grid = document.getElementById('grid');
const materialsList = document.getElementById('materialsList');
const totalGeneralEl = document.getElementById('totalGeneral');
const truckEstimateEl = document.getElementById('truckEstimate');
const totalKeepEl = document.getElementById('totalKeep');
const searchInput = document.getElementById('search');

/* Build grid */
function buildGrid(){
  grid.innerHTML = '';
  ITEMS.forEach((it, idx) => {
    STATE[idx] = STATE[idx] || { qty:0, dismantle:false, full:false, keep:false };
    const idfrag = `i${idx}`;
    const card = document.createElement('div');
    card.className = 'card';
    card.dataset.cat = it.category;
    card.dataset.idx = idx;
    card.innerHTML = `
      <div class="card-top">
        <img class="thumb" src="images/${it.name.replace(/\s/g, '_')}.png" alt="${it.name}" onerror="this.style.opacity=0.25;">
        <div class="title">${it.name}</div>
      </div>

      <div class="controls">
        <button aria-label="moins" onclick="changeQty(${idx}, -1)">‚àí</button>
        <div class="qty" id="qty-i${idx}">${STATE[idx].qty}</div>
        <button aria-label="plus" onclick="changeQty(${idx}, 1)">+</button>
      </div>

      <div class="opts">
        ${it.dismantle ? `<label><input type="checkbox" id="dism-i${idx}" onchange="onDismToggle(${idx})"> d√©mont√©</label>` : ''}
        ${it.canBeFull ? `<label><input type="checkbox" id="full-i${idx}" onchange="onFullToggle(${idx})"> full</label>` : ''}
        <label><input type="checkbox" id="keep-i${idx}" onchange="onKeepToggle(${idx})"> R√©cup</label>
      </div>
    `;
	
	// ‚úÖ Ajout du marqueur visuel sur les cartes s√©lectionn√©es
    if (STATE[idx].qty > 0 || STATE[idx].keep || STATE[idx].full) {
      card.classList.add('selected');
    } else {
      card.classList.remove('selected');
    }
	
    grid.appendChild(card);
  });
}

/* Quantity change */
function changeQty(idx, delta){
  STATE[idx] = STATE[idx] || { qty:0, dismantle:false, full:false, keep:false };
  STATE[idx].qty = Math.max(0, (STATE[idx].qty||0) + delta);
  const el = document.getElementById(`qty-i${idx}`);
  if(el) el.textContent = STATE[idx].qty;
  updateTotals();
}

/* Checkboxes behavior */
function onDismToggle(idx){
  const checked = document.getElementById(`dism-i${idx}`)?.checked || false;
  STATE[idx] = STATE[idx] || { qty:0, dismantle:false, full:false, keep:false };
  STATE[idx].dismantle = !!checked;
  if(checked){
    // if dismantled, uncheck keep
    STATE[idx].keep = false;
    const keepBox = document.getElementById(`keep-i${idx}`);
    if(keepBox) keepBox.checked = false;
  }
  updateTotals();
}
function onFullToggle(idx){
  const checked = document.getElementById(`full-i${idx}`)?.checked || false;
  STATE[idx] = STATE[idx] || { qty:0, dismantle:false, full:false, keep:false };
  STATE[idx].full = !!checked;
  updateTotals();
}
function onKeepToggle(idx){
  const checked = document.getElementById(`keep-i${idx}`)?.checked || false;
  STATE[idx] = STATE[idx] || { qty:0, dismantle:false, full:false, keep:false };
  STATE[idx].keep = !!checked;
  if(checked){
    // if kept, uncheck dismantle
    STATE[idx].dismantle = false;
    const dismBox = document.getElementById(`dism-i${idx}`);
    if(dismBox) dismBox.checked = false;
  }
  updateTotals();
}

/* Apply search & category filters */
function applyFilters(){
  const q = (searchInput.value || '').trim().toLowerCase();
  const activeCatBtn = document.querySelector('.cats button.active');
  const cat = activeCatBtn ? activeCatBtn.dataset.cat : 'Tous';
  Array.from(grid.children).forEach(card=>{
    const idx = parseInt(card.dataset.idx,10);
    const it = ITEMS[idx];
    const matchesCat = (cat === 'Tous' || it.category === cat);
    const matchesSearch = (!q) || (it.name.toLowerCase().includes(q));
    card.style.display = (matchesCat && matchesSearch) ? '' : 'none';
  });
}

/* Category buttons */
document.querySelectorAll('.cats button').forEach(btn=>{
  btn.addEventListener('click', e=>{
    document.querySelectorAll('.cats button').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    applyFilters();
  });
});
searchInput.addEventListener('input', applyFilters);

/* Totals calculation */
function updateTotals(){
  const totals = {}; // mat√©riel -> volume
  let totalGlobal = 0;
  let totalKeep = 0;

  ITEMS.forEach((it, idx) => {
    const state = STATE[idx] || {qty:0, dismantle:false, full:false, keep:false};
    const qty = state.qty || 0;
    if(qty === 0) return;

    // base volume
    const base = it.volume;
    const isDism = it.dismantle && state.dismantle;
    const effectivePerItem = isDism ? (base * 0.7) : base;

    // ‚öôÔ∏è Si l‚Äôobjet est √† r√©cup√©rer : il NE s‚Äôajoute pas aux mat√©riaux,
    // seulement au total "R√©cup"
    if (state.keep) {
      totalKeep += effectivePerItem * qty;
      totalGlobal += effectivePerItem * qty;
      return; // ne pas compter dans le reste
    }

    // Sinon, objet normal ‚Üí ajout√© √† son mat√©riau
    totals[it.material] = (totals[it.material] || 0) + (effectivePerItem * qty);
    totalGlobal += effectivePerItem * qty;

    // Si "full" est coch√© ‚Üí ajoute 20% du volume dans "Tout venant"
    if (state.full) {
      const extraPerItem = (it.fullValue !== undefined) ? it.fullValue : (base * 0.20);
      totals["Tout venant"] = (totals["Tout venant"] || 0) + (extraPerItem * qty);
      totalGlobal += extraPerItem * qty;
    }
  });

  // --- Rendu visuel des mat√©riaux ---
  const order = ["Bois","Mobilier","√âlectrom√©nager","Carton","Ferraille","Tout venant"];
  materialsList.innerHTML = '';
  const presentKeys = Object.keys(totals);
  order.forEach(k=>{
    if(totals[k]) {
      const el = document.createElement('div');
      el.className = 'mat-row';
      el.innerHTML = `<div>${k}</div><div>${totals[k].toFixed(2)} m¬≥</div>`;
      materialsList.appendChild(el);
    }
  });
  // autres mat√©riaux √©ventuels
  presentKeys.forEach(k=>{
    if(order.indexOf(k) === -1){
      const el = document.createElement('div');
      el.className = 'mat-row';
      el.innerHTML = `<div>${k}</div><div>${totals[k].toFixed(2)} m¬≥</div>`;
      materialsList.appendChild(el);
    }
  });

  // Totaux g√©n√©raux
  totalGeneralEl.textContent = `${totalGlobal.toFixed(2)} m¬≥`;
  totalKeepEl.textContent = `${totalKeep.toFixed(2)} m¬≥`;

  // Estimation camions
  const trucks = totalGlobal / 11;
  truckEstimateEl.textContent = `üöö ${trucks.toFixed(2)}`;
}

/* Reset */
function resetAll(){
  Object.keys(STATE).forEach(k=>{
    STATE[k] = { qty:0, dismantle:false, full:false, keep:false };
  });
  buildGrid();
  updateTotals();
}

// === G√©n√©ration du PDF des objets √† garder ===
const pdfBtn = document.getElementById("telechargerPDF");

pdfBtn.addEventListener("click", () => {
  const { jsPDF } = window.jspdf;
  if (!jsPDF) {
    alert("La biblioth√®que jsPDF n'est pas charg√©e !");
    return;
  }
  const doc = new jsPDF();

  // R√©cup√®re tous les objets "√† garder"
  const objetsAGarder = [];
  ITEMS.forEach((it, idx) => {
    const st = STATE[idx];
    if (st && st.keep && (st.qty || 1) > 0) {
      objetsAGarder.push({
        nom: it.name,
        categorie: it.category,
        volume: it.volume * (st.qty || 1)
      });
    }
  });

  if (objetsAGarder.length === 0) {
    alert("Aucun objet s√©lectionn√© en R√©cup !");
    return;
  }

  // --- Contenu du PDF ---
  const today = new Date().toLocaleDateString("fr-FR");
  doc.setFont("helvetica", "bold");
  doc.setFontSize(16);
  doc.text(`R√©capitulatif des objets √† garder`, 20, 20);
  doc.setFontSize(12);
  doc.setFont("helvetica", "normal");
  doc.text(`Date : ${today}`, 20, 30);

  let y = 45;
  objetsAGarder.forEach((obj, i) => {
    doc.text(`${i + 1}. ${obj.nom}  (${obj.categorie}) - ${obj.volume.toFixed(2)} m¬≥`, 20, y);
    y += 8;
    if (y > 280 && i < objetsAGarder.length - 1) {
      doc.addPage();
      y = 20;
    }
  });

  doc.save("recapitulatif_objets_a_garder.pdf");
});



/* Expose helpers for inline handlers if necessary */
window.changeQty = changeQty;
window.onDismToggle = onDismToggle;
window.onFullToggle = onFullToggle;
window.onKeepToggle = onKeepToggle;
window.resetAll = resetAll;

/* Init */
buildGrid();
applyFilters();
updateTotals();
</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
  const recapBar = document.querySelector('aside');
  let lastScrollY = 0;

  window.addEventListener('scroll', () => {
    const currentY = window.scrollY;

    // Si l'utilisateur descend de plus de 100px ‚Üí afficher
    if (currentY > 100) {
      recapBar.classList.add('visible');
    } else {
      recapBar.classList.remove('visible');
    }

    lastScrollY = currentY;
  });
</script>


</body>
</html>
