<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Calculateur de Volume Mobile</title>
<style>
:root {
  --accent: #ff7f00;
  --bg: #f9f9f9;
  --card: #fff;
  --dark: #222;
}
body {
  font-family: Arial, sans-serif;
  margin: 0;
  background: var(--bg);
  color: #222;
}

/* HEADER */
header {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  background: var(--dark);
  color: white;
  z-index: 1000;
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 10px 0;
  box-shadow: 0 2px 6px rgba(0,0,0,0.15);
}
.search-wrap {
  width: 90%;
  display: flex;
  justify-content: center;
}
#search {
  width: 100%;
  max-width: 600px;
  padding: 8px 14px;
  border-radius: 24px;
  border: none;
}
.cats {
  margin-top: 8px;
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 6px;
}
.cats button {
  border: none;
  background: #444;
  color: #eee;
  border-radius: 18px;
  padding: 6px 12px;
  cursor: pointer;
}
.cats button.active, .cats button:hover {
  background: var(--accent);
  color: white;
}

/* GRID */
.page {
  display: flex;
  flex-direction: column;
  align-items: center;
  padding-top: 130px;
  padding-bottom: 160px;
}
.grid {
  display: grid;
  gap: 12px;
  grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
  width: 95%;
  max-width: 900px;
}
.card {
  background: var(--card);
  border-radius: 10px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.1);
  padding: 10px;
  display: flex;
  flex-direction: column;
  align-items: stretch;
  position: relative;
}
.card.selected::after {
  content: "";
  position: absolute;
  top: 8px;
  right: 8px;
  width: 12px;
  height: 12px;
  background: var(--accent);
  border-radius: 50%;
}
.card-top {
  display: flex;
  align-items: center;
  gap: 10px;
}
.thumb {
  width: 42px;
  height: 42px;
  border-radius: 8px;
  object-fit: cover;
  background: #eee;
}
.title {
  font-size: 14px;
  font-weight: bold;
}
.controls {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 6px;
  margin-top: 6px;
}
.controls button {
  width: 26px;
  height: 26px;
  border-radius: 50%;
  border: none;
  background: var(--accent);
  color: white;
  font-weight: bold;
  cursor: pointer;
}
.qty {
  width: 32px;
  text-align: center;
  font-weight: bold;
}
.opts {
  display: flex;
  justify-content: center;
  gap: 8px;
  margin-top: 6px;
  font-size: 12px;
  flex-wrap: wrap;
}
.opts label {
  display: flex;
  align-items: center;
  gap: 4px;
  cursor: pointer;
}

/* FOOTER (totaux) */
footer {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  background: var(--card);
  border-top: 1px solid #ddd;
  box-shadow: 0 -2px 6px rgba(0,0,0,0.1);
  padding: 10px 14px;
  display: flex;
  flex-direction: column;
  gap: 6px;
  font-size: 14px;
}
.total-row {
  display: flex;
  justify-content: space-between;
  font-weight: bold;
}
.truck {
  text-align: right;
  color: var(--accent);
  font-style: italic;
}
</style>
</head>
<body>

<header>
  <div class="search-wrap">
    <input type="text" id="search" placeholder="🔍 Rechercher un objet...">
  </div>
  <div class="cats">
    <button onclick="filterCat('Tous')" class="active">Tous</button>
    <button onclick="filterCat('Salon')">Salon</button>
    <button onclick="filterCat('Séjour')">Séjour</button>
    <button onclick="filterCat('Cuisine')">Cuisine</button>
    <button onclick="filterCat('Chambres')">Chambres</button>
    <button onclick="filterCat('Garage')">Garage</button>
    <button onclick="filterCat('Jardin')">Jardin</button>
    <button onclick="filterCat('Sanitaire')">Sanitaire</button>
  </div>
</header>

<div class="page">
  <div class="grid" id="grid"></div>
</div>

<footer>
  <div class="total-row"><div>Total général :</div><div id="totalGeneral">0.00 m³</div></div>
  <div class="total-row"><div>À garder :</div><div id="totalKeep">0.00 m³</div></div>
  <div id="materialsList"></div>
  <div class="truck" id="truckEstimate">🚚 0.00</div>
</footer>

<script>
const ITEMS = [
  {category:'Salon', name:'Canapé 3 places', volume:2.5, material:'Mobilier', image:'https://cdn-icons-png.flaticon.com/512/809/809957.png'},
  {category:'Salon', name:'Armoire 2 portes', volume:2, material:'Bois', image:'https://cdn-icons-png.flaticon.com/512/2729/2729007.png', dismantle:true, canBeFull:true},
  {category:'Cuisine', name:'Frigo', volume:1, material:'Électroménager', image:'https://cdn-icons-png.flaticon.com/512/2928/2928828.png'},
  {category:'Cuisine', name:'Armoire cuisine', volume:1, material:'Bois', image:'https://cdn-icons-png.flaticon.com/512/1046/1046784.png', dismantle:true, canBeFull:true},
  {category:'Chambres', name:'Lit double', volume:2, material:'Bois', image:'https://cdn-icons-png.flaticon.com/512/3771/3771518.png', dismantle:true},
  {category:'Garage', name:'Vélo', volume:0.8, material:'Ferraille', image:'https://cdn-icons-png.flaticon.com/512/2967/2967436.png'},
  {category:'Jardin', name:'Tondeuse', volume:0.3, material:'Ferraille', image:'https://cdn-icons-png.flaticon.com/512/3264/3264935.png'},
  {category:'Sanitaire', name:'Machine à laver', volume:0.5, material:'Électroménager', image:'https://cdn-icons-png.flaticon.com/512/808/808593.png'}
];

const STATE = [];

function buildGrid() {
  const grid = document.getElementById('grid');
  grid.innerHTML = '';
  ITEMS.forEach((it, idx) => {
    STATE[idx] = STATE[idx] || {qty:0, dismantle:false, full:false, keep:false};
    const card = document.createElement('div');
    card.className = 'card';
    card.dataset.cat = it.category;
    card.innerHTML = `
      <div class="card-top">
        <img class="thumb" src="${it.image}" alt="${it.name}">
        <div class="title">${it.name}</div>
      </div>
      <div class="controls">
        <button onclick="changeQty(${idx}, -1)">−</button>
        <div class="qty" id="qty-${idx}">0</div>
        <button onclick="changeQty(${idx}, 1)">+</button>
      </div>
      <div class="opts">
        ${it.dismantle ? `<label><input type="checkbox" onchange="toggleOption(${idx}, 'dismantle')"> démonté</label>` : ''}
        ${it.canBeFull ? `<label><input type="checkbox" onchange="toggleOption(${idx}, 'full')"> full</label>` : ''}
        <label><input type="checkbox" onchange="toggleOption(${idx}, 'keep')"> garder</label>
      </div>
    `;
    grid.appendChild(card);
  });
}

function changeQty(idx, delta){
  STATE[idx].qty = Math.max(0, (STATE[idx].qty||0) + delta);
  document.getElementById(`qty-${idx}`).textContent = STATE[idx].qty;
  updateTotals();
}

function toggleOption(idx, key){
  const state = STATE[idx];
  if(key==='keep' && state.keep===false){
    state.dismantle=false;
    state.full=false;
  }
  state[key] = !state[key];
  updateTotals();
}

function updateTotals(){
  const totalGeneralEl = document.getElementById('totalGeneral');
  const totalKeepEl = document.getElementById('totalKeep');
  const materialsList = document.getElementById('materialsList');
  const truckEstimateEl = document.getElementById('truckEstimate');

  const totals = {};
  let totalGlobal = 0;
  let totalKeep = 0;

  ITEMS.forEach((it, idx)=>{
    const s = STATE[idx];
    if(!s.qty) return;
    let vol = it.volume;
    if(it.dismantle && s.dismantle) vol *= 0.7;
    if(s.keep){
      totalKeep += vol * s.qty;
    } else {
      totals[it.material] = (totals[it.material]||0) + vol*s.qty;
      totalGlobal += vol*s.qty;
      if(it.canBeFull && s.full){
        const extra = vol * 0.2;
        totals["Tout venant"] = (totals["Tout venant"]||0) + extra*s.qty;
        totalGlobal += extra*s.qty;
      }
    }
  });

  materialsList.innerHTML = '';
  Object.keys(totals).forEach(mat=>{
    const el = document.createElement('div');
    el.className = 'total-row';
    el.innerHTML = `<div>${mat}</div><div>${totals[mat].toFixed(2)} m³</div>`;
    materialsList.appendChild(el);
  });
  totalGeneralEl.textContent = totalGlobal.toFixed(2)+' m³';
  totalKeepEl.textContent = totalKeep.toFixed(2)+' m³';
  truckEstimateEl.textContent = '🚚 ' + (totalGlobal/11).toFixed(2);
}

function filterCat(cat){
  document.querySelectorAll('.cats button').forEach(b=>b.classList.remove('active'));
  const btn = [...document.querySelectorAll('.cats button')].find(b=>b.textContent===cat);
  if(btn) btn.classList.add('active');
  document.querySelectorAll('.card').forEach(c=>{
    c.style.display = (cat==='Tous' || c.dataset.cat===cat) ? '' : 'none';
  });
}

document.addEventListener('DOMContentLoaded', () => {
  buildGrid();

  document.getElementById('search').addEventListener('input', e=>{
    const q = e.target.value.toLowerCase();
    document.querySelectorAll('.card').forEach(c=>{
      const title = c.querySelector('.title').textContent.toLowerCase();
      c.style.display = title.includes(q) ? '' : 'none';
    });
  });
});
</script>

</body>
</html>
